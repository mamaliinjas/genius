{% load static %}


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ song.title }} - Details</title>
    <link rel="stylesheet" href="{% static 'css/song_details.css' %}">
</head>

<body>
    <header>
        {% include 'navbar.html' %}
    </header>

    <div class="song-details-container">
        <div class="song-info">
            <img src="{{ song.song_cover.url }}" alt="{{ song.title }} Cover" class="song-cover">
            <h1>{{ song.title }}</h1>
            <h2>By {{ song.artist.name }}</h2>
            <p>Duration: {{ song.duration }}</p>
            <p>Release Date: {{ song.release_date }}</p>
            <p>Views: {{ song.views }}</p>
            <audio id="song-audio" controls>
                <source src="{{ song.audio_file.url }}" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
        </div>

        <div class="song-audio-container">
            {% if song.audio_file and song.audio_file.url %}
            <audio id="song-audio" controls>
                <source src="{{ song.audio_file.url }}" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
            {% else %}
            <p>No audio file available for this song.</p>
            {% endif %}
        </div>
        <div class="lyrics-section">
            <h2>Lyrics</h2>
            <div class="lyrics-container">
                {% for line in lyrics %}
                <div class="lyric-line-container">
                    <p class="lyric-line" data-timestamp="{{ line.timestamp|date:'H:i:s' }}">
                        {{ line.line_text }}
                    </p>
                    {% if line.meaning %}
                    <p class="lyric-meaning">
                        <em>Meaning:</em> {{ line.meaning }}
                    </p>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>


    <script>
        const audio = document.getElementById('song-audio');
        const lyricLines = document.querySelectorAll('.lyric-line');

        audio.addEventListener('timeupdate', () => {
            const currentTime = audio.currentTime; // Current time in seconds
            lyricLines.forEach(line => {
                const timestamp = line.getAttribute('data-timestamp').split(':');
                const lineTime = parseInt(timestamp[0]) * 3600 + parseInt(timestamp[1]) * 60 + parseFloat(timestamp[2]);
                if (currentTime >= lineTime) {
                    line.classList.add('highlight');
                } else {
                    line.classList.remove('highlight');
                }
            });
        });
    </script>
</body>

</html>